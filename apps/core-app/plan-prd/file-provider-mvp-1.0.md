# 文件提供者 MVP 1.0 计划

## 1. 概述

本计划旨在实现文件提供者的最小可行产品（MVP）版本1.0，只包含最基本的功能，以便快速验证核心概念。

## 2. MVP 1.0 目标

1. 实现基本的文件索引功能
2. 实现基本的文件搜索功能
3. 实现基本的文件执行功能
4. 验证核心架构的可行性

## 3. 要实现的功能

### 3.1 文件索引功能

#### 要做什么：
1. 创建一个简单的脚本，能够遍历指定文件夹（如"文档"文件夹）
2. 读取每个文件的路径、名称、修改时间
3. 将这些信息存储到SQLite数据库的files表中

#### 具体实现：
- 使用Node.js的fs模块遍历文件夹
- 获取文件的基本信息（路径、名称、修改时间）
- 使用现有的数据库工具将文件信息存储到files表中

### 3.2 文件搜索功能

#### 要做什么：
1. 实现onSearch接口
2. 当用户输入关键词时，使用简单的SQL LIKE语句在数据库中查询文件名
3. 将查询结果包装成TuffItem格式返回

#### 具体实现：
- 实现ISearchProvider接口的onSearch方法
- 使用SQL LIKE语句进行简单匹配查询
- 将数据库查询结果转换为TuffItem格式

### 3.3 文件执行功能

#### 要做什么：
1. 实现onExecute接口
2. 用户点击搜索结果时，调用Electron的shell.openPath()方法
3. 使用系统默认程序打开文件或文件夹

#### 具体实现：
- 实现ISearchProvider接口的onExecute方法
- 使用Electron的shell.openPath()打开文件

## 4. 暂时不考虑的功能

### 4.1 文件索引相关
- **FR-4 断点续传**：先一次性扫描完成，如果崩溃就重新开始
- **FR-5 进度反馈**：后台默默扫描，扫描完成即可
- **FR-13 资源监控**：先不考虑性能，让程序尽情运行
- **FR-3 黑名单/白名单**：先扫描所有文件，不进行过滤

### 4.2 文件搜索相关
- **FR-7 拼音/模糊搜索**：先只支持关键词精确匹配
- **FR-9 智能排序**：按数据库默认顺序返回结果

### 4.3 文件执行相关
- **FR-11 文件预览**：不提供预览功能，点击直接打开
- **FR-12 记录日志**：不记录用户行为日志

## 5. 技术实现要点

### 5.1 核心类设计
```typescript
class FileProvider implements ISearchProvider {
  readonly id = 'file-provider'
  readonly name = 'File Provider'
  readonly type = 'file' as const

  // 初始化方法
  async onLoad(context: ProviderContext): Promise<void>

  // 搜索方法
  async onSearch(query: TuffQuery): Promise<TuffItem[]>

  // 执行方法
  async onExecute(args: IExecuteArgs): Promise<void>
}
```

### 5.2 数据库操作
- 使用现有的数据库工具方法：
  - `addFile`: 添加文件记录
  - `getFileByPath`: 根据路径获取文件
  - `updateFile`: 更新文件记录
  - `removeFile`: 删除文件记录

### 5.3 文件遍历
- 使用Node.js的fs模块递归遍历文件夹
- 获取文件基本信息（路径、名称、修改时间）
- 过滤掉目录，只处理文件

## 6. 开发计划

### 6.1 第一阶段：文件索引功能
1. 实现文件夹遍历功能
2. 实现文件信息读取功能
3. 实现数据库存储功能

### 6.2 第二阶段：文件搜索功能
1. 实现onSearch接口
2. 实现简单的SQL查询功能
3. 实现结果转换功能

### 6.3 第三阶段：文件执行功能
1. 实现onExecute接口
2. 实现文件打开功能

### 6.4 第四阶段：集成测试
1. 测试文件索引功能
2. 测试文件搜索功能
3. 测试文件执行功能

## 7. 验收标准

### 7.1 功能验收
1. 能够成功遍历指定文件夹并读取文件信息
2. 能够将文件信息正确存储到数据库
3. 能够根据关键词搜索文件
4. 能够正确打开搜索到的文件

### 7.2 性能验收
1. 在合理时间内完成文件索引
2. 搜索响应时间在可接受范围内

### 7.3 兼容性验收
1. 在目标操作系统上能够正常运行
2. 能够处理不同类型的文件

## 8. 风险评估

### 8.1 技术风险
1. 文件夹遍历时可能遇到权限问题
2. 大量文件可能导致内存占用过高
3. 数据库操作可能出现错误

### 8.2 应对措施
1. 实现错误处理机制
2. 对大文件夹进行分批处理
3. 实现数据库操作的重试机制

## 9. 后续优化方向

### 9.1 MVP 1.1
1. 实现断点续传功能
2. 实现进度反馈功能
3. 实现基本的黑白名单过滤

### 9.2 MVP 1.2
1. 实现拼音匹配功能
2. 实现智能排序功能
3. 实现文件预览功能

### 9.3 MVP 2.0
1. 实现资源监控功能
2. 实现完整的配置管理
3. 实现高级搜索功能